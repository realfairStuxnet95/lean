$(document).ready(function(){
	var input=[];
	$("#frm_login").submit(function(e){
		e.preventDefault();
		var email=$("#email").val();
		var password=$("#password").val();

		login_request(email,password);
	});
	$("a.btn_approve_teacher").click(function(){
		var teacher_id=$(this).attr("teacher_id");
		if(confirm("Are You sure. You want to Verify and Approve this Instructor")){
			input[0]='verify_reg_teacher';
			input[1]=teacher_id;

			requestHandling(input,false,'',false,'');
		}
	});
	$("#frm_add_teacher").submit(function(e){
		e.preventDefault();
		var inst_names=$("#inst_names").val();
		var inst_mail=$("#inst_mail").val();
		var inst_phone=$("#inst_phone").val();
		var inst_status=$("#inst_status").val();
		var redirectUrl="?request=manage_teachers";
		input[0]='create_teacher';
		input[1]=inst_names;
		input[2]=inst_mail;
		input[3]=inst_phone;
		input[4]=inst_status;
		requestHandling(input,false,'',true,redirectUrl);
	});
	$("#frm_add_user").submit(function(e){
		e.preventDefault();
		var inst_names=$("#inst_names").val();
		var inst_mail=$("#inst_mail").val();
		var inst_phone=$("#inst_phone").val();
		var inst_status=$("#inst_status").val();
		var password=$("#password").val();
		var confirm_pwd=$("#confirm_pwd").val();
		var redirectUrl="?request=system_users";
		input[0]='create_user';
		input[1]=inst_names;
		input[2]=inst_mail;
		input[3]=inst_phone;
		input[4]=inst_status;
		input[5]=password;
		if(password.length>=6){
			if(password.match(confirm_pwd)){
				requestHandling(input,false,'',true,redirectUrl);
			}else{
				alert("Entered Password do not Match");
			}
		}else{
			alert("Password Must be atleast 6 Characters");
		}
		
	});
	$("#credit_type").change(function(){
		var credit_type=$(this).val();
		if(credit_type.match("VIDEO")){
			$("#div_video").show();
		}else{
			$("#div_video").hide();
		}
	});
	$("#frm_add_course").submit(function(e){
		e.preventDefault();
		var course_title=$("#course_title").val();
		var course_price=$("#course_price").val();
		var assigned_teacher=$("#assigned_teacher").val();
		var summary=$(".course_summary").val();
		if(summary.length>=10){
			input[0]='save_course';
			input[1]=course_title;
			input[2]=course_price;
			input[3]=assigned_teacher;
			input[4]=summary;
			requestHandling(input,false,'',true,"?request=course_listing");
		}else{
			alert("Please Click Again on SAVE COURSE button to confirm action.");
		}
	});
	$("#frm_edit_course").submit(function(e){
		e.preventDefault();
		var course_id=$("#course_id").val();
		var course_title=$("#course_title").val();
		var course_price=$("#course_price").val();
		var assigned_teacher=$("#assigned_teacher").val();
		var summary=$(".course_summary").val();
		var edit_counter=$("#edit_counter").val();
		if(summary.length>=10){
			input[0]='edit_course';
			input[1]=course_title;
			input[2]=course_price;
			input[3]=assigned_teacher;
			input[4]=summary;
			input[5]=course_id;
			if(edit_counter>=1){
				requestHandling(input,false,'',true,"?request=course_listing");
			}else{
				$("#edit_counter").val(1);
				alert("Please Click Again on EDIT COURSE button to confirm action.");
			}
			
		}else{
			alert("Please Click Again on EDIT COURSE button to confirm action.");
		}
	});
	$("#frm_add_credit").submit(function(e){
		e.preventDefault();
		var summary=$(".credit_summary").val();
		if(summary.length>=10){
           $.ajax({  
                url:"save_credit",  
                method:"POST",  
                data:new FormData(this),  
                contentType:false,  
                processData:false,  
                success:function(data)  
                { 
                  if(data.match("200")){
                    window.location="?request=list_credits";
                  }else{
                    alert(data);
                  }          
                }  
           });
		}else{
			alert("Please Click Again on SAVE CREDIT button to confirm action.");
		}
	});
	var credit_title;
	$("#frm_add_quiz").submit(function(e){
		e.preventDefault();
		var credit_id=$("#credit_id").val();
		var quiz_summary=$(".quiz_summary").val();
		var quiz_title=$("#quiz_title").val();

		input[0]="save_quiz";
		input[1]=credit_id;
		input[2]=quiz_title;
		input[3]=quiz_summary;

		if(quiz_summary.length>=10){
			requestHandling(input,false,'',true,"?request=credit_quiz&title="+credit_title+"&credit="+credit_id);
		}else{
			alert("Please Click Again on SAVE QUIZ button to confirm action.");
		}
	});
	$("#btnAddQuiz").click(function(){
		var credit=$(this).attr("credit");
		credit_title=$(this).attr("title");
		$("#quiz_modal").modal();
		$("#credit_id").val(credit);
	});
	$("#btnQuestions").click(function(){
		var quiz=$(this).attr("quiz");
		var quiz_title=$(this).attr("title");
		$("#question_modal").modal();
		$("#quiz_id").val(quiz);
		$("#question_quiz").html("Quiz: "+quiz_title);
	});
	$("#frm_save_question").submit(function(e){
		e.preventDefault();
		var question_text=$("#question_text").val();
		var answer1=$("#answer1").val();
		var answer2=$("#answer2").val();
		var answer3=$("#answer3").val();
		var answer4=$("#answer4").val();
		var answer5=$("#answer5").val();
		var quiz_id=$("#quiz_id").val();

		input[0]="save_question";
		input[1]=question_text;
		input[2]=answer1;
		input[3]=answer2;
		input[4]=answer3;
		input[5]=answer4;
		input[6]=answer5;
		input[7]=quiz_id;
		requestHandling(input,false,'',false,"?request=credit_quiz&title="+credit_title+"&credit="+credit_id);
	});
	$("ul.answers_list>li>a").click(function(){
		var text=$(this).attr("name");
		var question=$(this).attr("question");
		input[0]="correct_answer";
		input[1]=text;
		input[2]=question;
		requestHandling(input,false,'',false,"?request=credit_quiz");
	});
	$("a.btn_approve_request").click(function(){
		var request_id=$(this).attr("request");
		if(confirm("Do you want to Approve this Request??")){
			input[0]="approve_course_request";
			input[1]=request_id;
			 requestHandling(input,false,'',false,'');
		}
	});
	$(".btn_add_to_learn").click(function(){
		var course_id=$(this).attr("course");
		$("#course_id_learn").val(course_id);
		$("#learnModal").modal();
	});
	$("#frm_add_to_learn").submit(function(e){
		e.preventDefault();
		var to_learn=$("#what_to_learn").val();
		var course_id=$("#course_id_learn").val();
		input[0]="save_to_learn";
		input[1]=course_id;
		input[2]=to_learn;
		requestHandling(input,false,'',false,'');
	});
	$("a.btn_delete_to_learn").click(function(){
		var to_learn=$(this).attr("to_learn");
		if(confirm("Do you want to delete This")){
			input[0]="remove_to_learn";
			input[1]=to_learn;
			requestHandling(input,false,'',false,'');
		}
	});
	$("a.btn_delete_course").click(function(){
		var course_id=$(this).attr("course_id");
		if(confirm("Do you want to delete this Course")){
			input[0]="delete_course";
			input[1]=course_id;
			requestHandling(input,false,'',false,'');
		}
	});
	$(".btn_view_message").click(function(){
		var message_id=$(this).attr("message_id");
		var name=$(this).attr("name");
		var email=$(this).attr("email");
		var message=$(this).attr("message");
		$("h3.sender_info").html("<strong>E-mail : "+email+"</strong>");
		$("p.sender_name").html("Sender : "+name);
		$("p.sender_message").html(message);
		$("#panel-modal").modal();

		input[0]="read_message";
		input[1]=message_id;
		readMessage(input);
	});

	$("#uploadFile").on("change",function(){
		var file=document.getElementById("uploadFile").files[0];
		var name = document.getElementById("uploadFile").files[0].name;
		var ext = name.split('.').pop().toLowerCase();
		  if(jQuery.inArray(ext, ['csv']) == -1) 
		  {
	      $("#uploadFile").val("");
		   alert("Invalid CSV File");
		  }else{
		  	$("#btnUpload").show();
		  }
	});
	$("#frm_upload_csv").submit(function(e){
		e.preventDefault();
		uploadCsvFile(new FormData(this));
	});
	$("a.btn_add_poster").click(function(){
		var modal=$("#posterModal");
		var course_id=$(this).attr("course_id");
		$("#course_id").val(course_id);
		modal.modal();
	});
	$("#frm_upload_course_poster").submit(function(e){
		e.preventDefault();
		var course_id=$("#course_id").val();
		if(course_id.length>=0){
			uploaFile(new FormData(this));
		}else{
			alert("System Error");
		}
		
	});
	$("a.btn_delete_client").click(function(){
		var client_id=$(this).attr("client_id");
		var client_name=$(this).attr("names");
		if(confirm("Do you want to Delete : "+client_name)){
			input[0]="delete_client";
			input[1]=client_id;
			requestHandling(input,false,'',false,'');
		}
	});
	$("a.btn_delete_user").click(function(){
		var system_user=$(this).attr("system_user");
		var names=$(this).attr("names");
		if(confirm("Do you want to Delete This User: "+names)){
			input[0]="delete_body";
			input[1]=system_user;
			requestHandling(input,false,'',false,'');
		}
	});
	$("a.btn_add_credit_no").click(function(){
		var course_id=$(this).attr("course_id");
		var credit_no = prompt("Enter Course Credit No: ", "");
		if (credit_no != null) {
			input[0]="add_credit_no";
			input[1]=course_id;
			input[2]=credit_no;
			requestHandling(input,false,'',false,'');
		}else{
			alert("Enter Valid Credit No");
		}
	});
});

function uploaFile(form_data){
       $.ajax({  
            url: "upload_poster",  
            type: "POST",  
            data:form_data,  
            contentType: false,  
            processData:false,  
            success: function(data)  
            {  
            	if(data.match("200")){
            		alert("Successfully Uploaded");
            		location.reload();
            	}else{
            		alert(data);
            	}
            	
            }  
       }); 
}
function uploadCsvFile(form_data){
       $.ajax({  
            url: "upload_client",  
            type: "POST",  
            data:form_data,  
            contentType: false,  
            processData:false,  
            success: function(data)  
            {  
            	alert(data);
            	location.reload();
            }  
       }); 
}

function readMessage(input){
	var url="request_handler";
	$.post(url,{
		input:input
	},function(response){
		if(response!="200"){
			alert(response);
		}
	});
}
function requestHandling(input,hasLoader,loaderref,has_redirect,redirectUrl){
	var url="request_handler";
	if(hasLoader){
		loaderref.show();
	}
	$.post(url,{
		input:input
	},function(response){
		if(hasLoader){
			loaderref.hide();
		}
		if(response.match("200")){
			if(has_redirect){
				window.location=redirectUrl;
			}else{
				location.reload();
			}
		}else{
			alert(response);
		}
	});
}
function login_request(email,password){
	$.post("login_request",{
		email:email,
		password:password
	},function(response){
		if(response.match("200")){
			window.location="index";
		}else{
			alert(response);
			console.log(response);
		}
	});
}