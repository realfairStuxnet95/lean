$(document).ready(function(){
	$("#frm_register_student").submit(function(e){
		e.preventDefault();
		var user_password=$("#user_password").val();
		var confirm_pwd=$("#confirm_pwd").val();
		if(user_password.length>=6){
			if(user_password.match(confirm_pwd)){
				registerStudent(new FormData(this));
			}else{
				showRegResult("Password do not match.Check again Please");
			}
		}else{
			showRegResult("Password Must be atleast 6 characters")
		}
	});
	$("#frm_user_login").submit(function(e){
		e.preventDefault();
		loginUser(new FormData(this));
	});
	$("#profile_image_input").on("change",function(){
		var file=document.getElementById("profile_image_input").files[0];
		var name = document.getElementById("profile_image_input").files[0].name;
		var ext = name.split('.').pop().toLowerCase();
		  if(jQuery.inArray(ext, ['gif','png','jpg','jpeg']) == -1) 
			  {
		      $("#profile_image_input").val("");
			   alert("Invalid Image File");
			  }else{
				var reader = new FileReader();
				reader.onload = function(){
					var dataURL = reader.result;
					var output = document.getElementById('profile');
					output.src = dataURL;
				};
				reader.readAsDataURL(file);
				//upload image now
				var form_data = new FormData();
				form_data.append("file", document.getElementById('profile_image_input').files[0]);
				updateProfileImage(form_data);
			  }

	});
});
function showLoader(loaderRef){
	loaderRef.show();
}
function hideLoader(loaderRef){
	loaderRef.hide();
}
function showRegResult(msg){
	var div_result=$("#div_result");
	var success_msg="You have Successfully being registered.Please Login to your Account";
	if(msg.match("200")){
		div_result.show().html(success_msg);
		div_result.css({
			background:'#009966',
			color:'#fff'
		});
	}else{
		div_result.show().html(msg);
		div_result.css({
			background:'#B6151B',
			color:'#fff'
		});
	}
}
function updateProfileImage(form_data){
   $.ajax({
    url:"upload_pic",
    method:"POST",
    data: form_data,
    contentType: false,
    cache: false,
    processData: false,
    beforeSend:function(){
    },   
    success:function(data)
    {
     if(data.match("200")){
     	location.reload();
     }else{
     	alert(data);
     }
    }
   });
}
function registerStudent(form_data){	
	var img_loader=$("#img_loader");
	showLoader(img_loader);
	$.ajax({  
	    url:"register_student",  
	    method:"POST",  
	    data:form_data,  
	    contentType:false,  
	    processData:false,  
	    success:function(data)  
	    { 
	    	hideLoader(img_loader);
	    	showRegResult(data);        
	    }  
	});
}
function loginUser(form_data){
	var img_loader=$("#img_loader");
	var redirectUrl="student";
	showLoader(img_loader);
	$.ajax({  
	    url:"login_user",  
	    method:"POST",  
	    data:form_data,  
	    contentType:false,  
	    processData:false,  
	    success:function(data)  
	    { 
	    	hideLoader(img_loader);
	    	if(data.match("200")){
	    		window.location=redirectUrl;
	    	}else{
	    		showRegResult(data); 
	    	}
	    	       
	    }  
	});
}
